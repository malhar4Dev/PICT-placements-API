<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard</title>
    <link rel="stylesheet" href="dash3.css">
    <link rel="stylesheet" href="proto2.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.7.2/css/all.min.css"
        integrity="sha512-Evv84Mr4kqVGRNSgIGL/F/aIDqQb7xQ2vcrdIwxfjThSH8CSR7PBEakCr51Ck+w+/U6swU2Im1vVX0SVk9ABhg=="
        crossorigin="anonymous" referrerpolicy="no-referrer" />
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Oswald:wght@200..700&family=Poppins:ital,wght@0,100;0,200;0,300;0,400;0,500;0,600;0,700;0,800;0,900;1,100;1,200;1,300;1,400;1,500;1,600;1,700;1,800;1,900&display=swap');
    </style>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>

<body>
    <div class="nav-div">
        <nav></nav>
    </div>
    <div class="textsec">
        <h1>Providing Deeper insight !</h1>
        <h3>with interesting UI and efficiet data Visualization techniques</h3>
    </div>
    <div class="dashboard">
        <div class="dash-nav">
            <i id="selectors" class="fa-solid fa-magnifying-glass-chart active"></i>
            <i id="placement-graphs" class="fa-solid fa-square-poll-vertical disabled"></i>
            <i id="lpa-graphs" class="fa-solid fa-chart-line disabled"></i>
            <i id="piechart" class="fa-solid fa-chart-pie disabled"></i>
            <i id="complist" class="fa-solid fa-ranking-star disabled"></i>
        </div>
        <div class="content">
            <div class="selectors">
                <h2 id="content-h2">Choose any year or company for complete analysis :</h2>
                <div class="topbox" style="font-family: sans-serif;">
                    <div class="selection-fields">
                        <div class="dropdown-wrapper">
                            <div class="dropdown-btn">
                                <div class="tags-container" id="year-tags-container"></div>
                                <span id="selected-year">Select Year</span>
                                <span><i class="fa-solid fa-caret-down"></i></span>
                            </div>
                            <div class="dropdown-menu year-menu">
                                <div class="item">All years</div>
                                <div class="item">2019 -20</div>
                                <div class="item">2020 -21</div>
                                <div class="item">2021 -22</div>
                                <div class="item">2022 -23</div>
                                <div class="item">2023 -24</div>
                            </div>
                        </div>

                        <div class="dropdown-wrapper">
                            <div class="dropdown-btn">
                                <div class="tags-container" id="company-tags-container"></div>
                                <span id="selected-company">Select Company</span>
                                <span><i class="fa-solid fa-caret-down"></i></span>
                            </div>
                            <div class="dropdown-menu comp-menu">
                                <div class="item">All Companies</div>
                            </div>
                        </div>

                        <div class="dropdown-wrapper">
                            <div class="dropdown-btn">
                                <div class="tags-container" id="skill-tags-container"></div>
                                <span id="selected-skill">Select Skill</span>
                                <span><i class="fa-solid fa-caret-down"></i></span>
                            </div>
                            <div class="dropdown-menu skill-menu">
                                <div class="item">All skills</div>
                                <div class="item">API Devlopment</div>
                                <div class="item">Adaptability</div>
                                <div class="item">App Devlopment</div>
                                <div class="item">Application Support</div>
                                <div class="item">Artificial Intelligence & Machine Learning</div>
                                <div class="item">Automation testing</div>
                                <div class="item">Automotive Electronics</div>
                                <div class="item">Blockchain</div>
                                <div class="item">CI/CD</div>
                                <div class="item">CRM Systems</div>
                                <div class="item">Cloud Computing</div>
                                <div class="item">Communication</div>
                                <div class="item">Consulting Skills</div>
                                <div class="item">Critical Thinking</div>
                                <div class="item">Cryptography</div>
                                <div class="item">Cybersecurity</div>
                                <div class="item">Data Analytics</div>
                                <div class="item">Database Management</div>
                                <div class="item">Design Expertise</div>
                                <div class="item">Digital Marketing</div>
                                <div class="item">Digital Signal Processing</div>
                                <div class="item">Embedded Systems</div>
                                <div class="item">Energy Analytics</div>
                                <div class="item">Financial Acumen</div>
                                <div class="item">GPU & Graphics Processing</div>
                                <div class="item">Game Development</div>
                                <div class="item">Hardware Mechatronics</div>
                                <div class="item">Healthcare Domain Knowledge</div>
                                <div class="item">Infrastructure Automation</div>
                                <div class="item">Inventory Management</div>
                                <div class="item">IoT</div>
                                <div class="item">Kubernetes</div>
                                <div class="item">Marketing</div>
                                <div class="item">Object-Oriented Design (OOD)</div>
                                <div class="item">PLC Programming</div>
                                <div class="item">Payment Gateway Devlopment</div>
                                <div class="item">Problem-Solving</div>
                                <div class="item">Programming Languages (Java Python C++ JavaScript)</div>
                                <div class="item">Project Management</div>
                                <div class="item">QA Methodologies</div>
                                <div class="item">Risk Analysis</div>
                                <div class="item">Robotics</div>
                                <div class="item">SAP</div>
                                <div class="item">SCADA Systems</div>
                                <div class="item">SDLC (Agile DevOps CI/CD)</div>
                                <div class="item">Software Development</div>
                                <div class="item">Software Development Methodologies</div>
                                <div class="item">Storage Technology</div>
                                <div class="item">Supply Chain Technology</div>
                                <div class="item">System Administration</div>
                                <div class="item">System Design & Scalability</div>
                                <div class="item">Teamwork & Collaboration</div>
                                <div class="item">Technical Proficiency</div>
                                <div class="item">Telecommunication Systems</div>
                                <div class="item">Testing</div>
                                <div class="item">UI/UX</div>
                                <div class="item">VLSI Design</div>
                                <div class="item">Version Control</div>
                                <div class="item">Web Development</div>
                                <div class="item">Workforce Management Systems</div>
                                <div class="item">control systems</div>
                                <div class="item">creativity</div>
                                <div class="item">data analysis</div>
                                <div class="item">networking</div>
                                <div class="item">semiconductor knowledge</div>
                                <div class="item">system Integration</div>
                                <div class="item">web technologies</div>
                            </div>
                        </div>
                    </div>
                    <button id="analyze-button">Analyze It</button>
                </div>

                <h3 id="content-h3">Note :</h3>
                <ol id="content-note-list">
                    <li>Select an year first. ( you can select multiple values )</li>
                    <li>Select skill-set (set to all-skillset by default )</li>
                    <li>Select the company</li>
                    <li>press the 'Analyze it' button</li>
                </ol>
                <h3 id="content-report-icon">ðŸ“œ</h3>
                <h3 id="content-report">Report log : keep track of what you've analysed so far!</h3>
                <div class="report-log">
                    <div id="log-entries"></div>
                </div>

            </div>

            <div class="placement-graphs">
                <!-- Graph and Skillset Section -->
                <div class="graph-and-skillset">
                    <div id="graph-gen" class="graph-container" style="display:none;">
                        <canvas id="results-chart"></canvas>
                    </div>
                    <div class="analysis">
                        <div class="lpa-fetched"></div>
                        <div class="skillset2"></div>
                        <div class="cgpa-criteria"></div>
                    </div>
                </div>
            </div>
            <div class="lpa-graphs" style="display: none;">
                <h2>LPA Trends Analysis</h2>
                <div id="lpa-graphs-container">
                    <canvas id="lpa-canvas"></canvas>
                </div>
            </div>
            <div class="piechart">
                <!-- Pie chart content will go here -->
                <h2>Top Skills Required</h2>
                <canvas id="skills-polar-chart">
                    
                </canvas>
                
            </div>
            <div class="complist">
                <div class="criteria-selection">
                    <h3>Select Criteria:</h3>
                    <label>
                        <input type="radio" name="criteria" value="lpa" checked> LPA
                    </label>
                    <label>
                        <input type="radio" name="criteria" value="placements"> Placements
                    </label>
                </div>
            
                <div id="overall-analysis-container">
                    <div class="canvas-wrapper">

                    </div>

                </div>
            
                <h2>Companies visited us during year </h2>
                <div class="comparound">
                    <div class="comp-names"></div>
                    <div class="comp-total"></div>
                </div>
            </div>
            </div>
        </div>
    </div>
    <footer></footer>

    <script src="drop.js" defer></script>

    <script>
        document.addEventListener('DOMContentLoaded', function () {
            const icons = document.querySelectorAll('.dash-nav i');
            const tabs = document.querySelectorAll('.content > div'); // This selects all tabs

            icons.forEach(icon => {
                icon.addEventListener('click', function () {
                    if (this.classList.contains('disabled')) {
                        console.log(`Icon ${this.id} is disabled`);
                        return; // Do nothing if the icon is disabled
                    }

                    console.log(`Clicked on ${this.id}`);

                    // Remove active class from all icons
                    icons.forEach(i => i.classList.remove('active'));

                    // Add active class to the clicked icon
                    this.classList.add('active');

                    // Hide all tabs
                    tabs.forEach(tab => {
                        tab.style.display = 'none'; // Hide all tabs
                        console.log(`Hiding tab: ${tab.className}`);
                    });

                    // Show the corresponding tab
                    const tabId = this.id;
                    const tabToShow = document.querySelector(`.content .${tabId}`);

                    if (tabToShow) {
                        console.log(`Showing tab: ${tabToShow.className}`);
                        tabToShow.style.display = 'flex'; // Show the selected tab

                        // Special handling for lpa-graphs
                        if (tabId === 'lpa-graphs' && window.selectedCompanies && window.selectedCompanies.length > 0) {
                            console.log('Generating LPA charts because tab was switched to it');
                            generateLPALineCharts(window.selectedCompanies);
                        }
                    } else {
                        console.error(`Tab for ${tabId} not found`);
                    }
                });
            });

            // Initially show the selectors tab
            document.querySelector('.selectors').style.display = 'flex';
        });


        // Analyze button functionality
        document.getElementById('analyze-button').addEventListener('click', async () => {
            if (selectedYears.length === 0) {
                alert('Please select at least one year.');
                return;
            }

            // Prepare the selected years and companies for the API call
            const selectedCompaniesList = selectedCompanies.length > 0 ? selectedCompanies : ['all companies'];
            const selectedYearsList = selectedYears.length > 0 ? selectedYears : ['all years'];

            // Fetch filtered data based on selected years and companies
            const responses = await Promise.all(selectedYearsList.map(year => {
                return Promise.all(selectedCompaniesList.map(company => {
                    return fetch(`/filtered_data?year=${year}&Company_name=${company}`);
                }));
            }));
            window.selectedCompanies = selectedCompanies;

            // Process the responses to extract male and female counts
            const dataCounts = responses.flat().map(response => response.json());
            const results = await Promise.all(dataCounts);

            // Prepare data for the chart
            const maleCounts = results.map(data => data.chartData ? data.chartData.maleCount : 0);
            const femaleCounts = results.map(data => data.chartData ? data.chartData.femaleCount : 0);
            const labels = results.map((data, index) => {
                const year = selectedYearsList[Math.floor(index / selectedCompaniesList.length)];
                const company = selectedCompaniesList[index % selectedCompaniesList.length];
                return `${company} (${year})`;
            });

            // Generate the chart
            generateChart(labels, maleCounts, femaleCounts);

            // Fetch and display skillset data
            fetchSkillsetData(selectedCompaniesList);
            fetchCGPACriteria(selectedCompaniesList);

            // Automatically switch to the placement-graphs tab
            const placementGraphsTab = document.querySelector('.placement-graphs');
            const placementGraphsIcon = document.getElementById('placement-graphs');

            // Remove active class from all icons
            document.querySelectorAll('.dash-nav i').forEach(icon => icon.classList.remove('active'));

            // Add active class to the placement-graphs icon
            placementGraphsIcon.classList.add('active');

            // Hide all tabs
            document.querySelectorAll('.content > div').forEach(tab => tab.style.display = 'none');

            window.selectedCompanies = selectedCompanies;


            // Enable all navigation icons
            document.querySelectorAll('.dash-nav i').forEach(icon => {
                icon.classList.remove('disabled');
                console.log(`Enabled icon: ${icon.id}`);
            });

            // Show the placement-graphs tab
            placementGraphsTab.style.display = 'flex';
        });

        function generateChart(labels, maleCounts, femaleCounts) {
            const ctx = document.getElementById('results-chart').getContext('2d');

            // Clear the previous chart if it exists
            if (Chart.getChart("results-chart")) {
                Chart.getChart("results-chart").destroy(); // Destroy the previous chart
            }

            const chart = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: labels,
                    datasets: [{
                        label: 'Male Placed Students',
                        data: maleCounts,
                        backgroundColor: 'rgba(54, 162, 235, 0.6)',
                        borderColor: 'rgba(54, 162, 235, 1)',
                        borderWidth: 2 // Thinner bars
                    }, {
                        label: 'Female Placed Students',
                        data: femaleCounts,
                        backgroundColor: 'rgba(255, 99, 132, 0.6)',
                        borderColor: 'rgba(255, 99, 132, 1)',
                        borderWidth: 2 // Thinner bars
                    }]
                },
                options: {
                    scales: {
                        y: {
                            beginAtZero: true,
                            ticks: {
                                callback: function (value) {
                                    return value; // Display the value on the y-axis
                                }
                            }
                        }
                    }
                }
            });

            // Show the graph container
            const graphContainer = document.getElementById('graph-gen');
            graphContainer.style.display = 'flex'; // Show graph
            graphContainer.classList.add('show'); // Add the show class for animation
        }

        // Function to fetch and display CGPA criteria
        async function fetchCGPACriteria(selectedCompaniesList) {
            try {
                const response = await fetch(`/cgpa?companies=${selectedCompaniesList.join(',')}`);
                const cgpaData = await response.json();

                const cgpaContainer = document.querySelector('.cgpa-criteria');
                cgpaContainer.innerHTML = '<h3>ðŸ“Š CGPA Criteria</h3>';

                Object.entries(cgpaData).forEach(([company, cgpas]) => {
                    // Ensure cgpas is an array and has valid data
                    const cgpaList = Array.isArray(cgpas) && cgpas.length > 0 ? cgpas.join(', ') : 'No CGPA data available';
                    cgpaContainer.innerHTML += `
                <div class="info-card">
                    <strong>${company}:</strong> <br> ${cgpaList}
                </div>
            `;
                });
            } catch (error) {
                console.error('Error fetching CGPA data:', error);
            }
        }

        async function fetchSkillsetData(selectedCompaniesList) {
            try {
                const skillsResponse = await fetch(`/skills?companies=${selectedCompaniesList.join(',')}`);
                const skillsData = await skillsResponse.json();

                // Display skillset data
                const skillsContainer = document.querySelector('.skillset2');
                skillsContainer.innerHTML = '<h3>ðŸš€ Required Skills</h3>';

                Object.entries(skillsData).forEach(([company, skills]) => {
                    let skillTags = skills.map(skill => `<span class="skill-tag">${skill}</span>`).join('');
                    skillsContainer.innerHTML += `
                        <div class="info-card">
                            <strong>${company}:</strong> <br> ${skillTags}
                        </div>
                    `;
                });
            } catch (error) {
                console.error('Error fetching skillset data:', error);
            }
        }

        function updateReportLog(year, company, lpa) {
            const logKey = "analysisLog";
            let logs = JSON.parse(sessionStorage.getItem(logKey)) || [];

            // Prevent duplicate entries for the same year & company
            const existingLog = logs.find(log => log.year === year && log.company === company);
            if (!existingLog) {
                logs.push({ year, company, lpa });
                sessionStorage.setItem(logKey, JSON.stringify(logs));
            }

            renderReportLog(); // Refresh the log display
        }

        // Function to render the report log from session storage
        function renderReportLog() {
            const reportLogContainer = document.querySelector('.report-log');
            reportLogContainer.innerHTML = ""; // Clear previous logs

            let logs = JSON.parse(sessionStorage.getItem("analysisLog")) || [];
            logs.forEach(log => {
                const logEntry = document.createElement('div');
                logEntry.classList.add('log-entry');
                logEntry.textContent = `ðŸ“… ${log.year} | ðŸ¢ ${log.company} | ðŸ’° ${log.lpa} LPA`;

                reportLogContainer.appendChild(logEntry);
            });

            // Ensure scrolling remains intact
            reportLogContainer.scrollTop = reportLogContainer.scrollHeight;
        }

        // Call this function on page load to display stored logs
        document.addEventListener("DOMContentLoaded", renderReportLog);

        // Modify the existing analyze-button event listener to include this function
        document.getElementById('analyze-button').addEventListener('click', async () => {
            if (selectedYears.length === 0 || selectedCompanies.length === 0) {
                alert('Please select at least one year and one company.');
                return;
            }

            const selectedYearsList = selectedYears.join(',');
            const selectedCompaniesList = selectedCompanies.join(',');

            try {
                // Fetch LPA Data
                const lpaResponse = await fetch(`/lpa?years=${selectedYearsList}&companies=${selectedCompaniesList}`);
                const lpaData = await lpaResponse.json();

                // Fetch Skills Data
                const skillsResponse = await fetch(`/skills?companies=${selectedCompaniesList}`);
                const skillsData = await skillsResponse.json();

                // Display LPA Data
                const lpaContainer = document.querySelector('.lpa-fetched');
                lpaContainer.innerHTML = '<h3>ðŸ’° Average LPA</h3>';

                lpaData.forEach(item => {
                    lpaContainer.innerHTML += `
                <div class="info-card lpa-entry">
                    <strong>${item.Company_name} (${item.year}):</strong> 
                    <span>â‚¹${item.sal_lpa} LPA</span>
                </div>
            `;

                    // Store in session storage & update log
                    updateReportLog(item.year, item.Company_name, item.sal_lpa);
                });

                // Display Skills Data
                const skillsContainer = document.querySelector('.skillset2');
                skillsContainer.innerHTML = '<h3>ðŸš€ Required Skills</h3>';

                Object.entries(skillsData).forEach(([company, skills]) => {
                    let skillTags = skills.map(skill => `<span class="skill-tag">${skill}</span>`).join('');
                    skillsContainer.innerHTML += `
                <div class="info-card">
                    <strong>${company}:</strong> <br> ${skillTags}
                </div>
            `;
                });

                // Show the analysis
                document.querySelector('.analysis').classList.add('show');

            } catch (error) {
                console.error('Error fetching data:', error);
            }
        });


    </script>
    <script src="lpagraph.js"></script>
    <script src="complist.js"></script>
    <script src="top10.js"></script>
    <script src="piechart.js"></script>
</body>

</html>